---
- name: Install dependencies for Netdata
  ansible.builtin.apt:
    name:
      - curl
      - bash
    state: present
    update_cache: yes

- name: Install Netdata using official install script (2025 URL)
  ansible.builtin.shell: |
    bash <(curl -Ss https://kickstart.netdata.cloud/install.sh) --disable-telemetry --non-interactive
  args:
    executable: /bin/bash
  become: yes
  register: netdata_install
  changed_when: "'already installed' not in netdata_install.stdout"

- name: Ensure Netdata service is enabled and running
  ansible.builtin.service:
    name: netdata
    state: started
    enabled: true
